using System;
using System.Collections.Generic;
using System.Text;
using Flame.Compiler;

namespace Flame.DSharp.Build
{
    public static class Warnings
    {
        public const string Pedantic = "pedantic";
        public const string Shadow = "shadow";
        public const string GenericOperators = "generic-operators";
        public const string Operators = "operators";
        public const string Bitcast = "bitcast";
        public const string MeaninglessCast = "meaningless-cast";

        public static const string GetWarningName(string Name)
        {
            return "W" + Name;
        }

        public static const string GetRelaxWarningName(string Name)
        {
            return "Wrelax-" + Name;
        }

        public static const string GetWarningNameMessage(string Name)
        {
            return "[-" + GetWarningName(Name) + "]";
        }

        public static bool IsPedantic[this ICompilerLog Log]
        {
            const get
            {
                if (Log.Options.HasOption(Pedantic))
                {
                    return Log.Options.GetOption<bool>(Pedantic, false);
                }
                else return Log.UseDefaultWarnings(Pedantic, false);
            }
        }

        private static const bool UseWarnings(this ICompilerLog Log, string Name, bool IsPedantic, bool DefaultValue)
        {
            string warningName = GetWarningName(Name);
            if (Log.Options.HasOption(warningName))
            {
                return Log.Options.GetOption<bool>(warningName, false);
            }
            else
            {
                string relaxName = GetRelaxWarningName(Name);
                if (Log.Options.HasOption(relaxName))
                {
                    return !Log.Options.GetOption<bool>(relaxName, true);
                }
                else if (IsPedantic)
                {
                    return Log.IsPedantic;
                }
                else return DefaultValue;
            }
        }

        public static const bool UsePedanticWarnings(this ICompilerLog Log, string Name)
        {
            return Log.UseWarnings(Name, true, false);
        }

        public static const bool UseDefaultWarnings(this ICompilerLog Log, string Name, bool DefaultValue)
        {
            return Log.UseWarnings(Name, false, DefaultValue);
        }
        public static const bool UseDefaultWarnings(this ICompilerLog Log, string Name)
        {
            return Log.UseDefaultWarnings(Name, true);
        }

        public static bool ShowShadowWarnings[this ICompilerLog Log]
        {
            const get return Log.UsePedanticWarnings(Shadow);
        }
        public static bool ShowOperatorWarnings[this ICompilerLog Log]
        {
            const get return Log.UseDefaultWarnings(Operators);
        }
        public static bool ShowGenericOperatorWarnings[this ICompilerLog Log]
        {
            const get return Log.UseDefaultWarnings(GenericOperators);
        }
        public static bool ShowBitcastWarnings[this ICompilerLog Log]
        {
            const get return Log.UsePedanticWarnings(Bitcast);
        }
        public static bool ShowMeaninglessCastWarnings[this ICompilerLog Log]
        {
            const get return Log.UsePedanticWarnings(MeaninglessCast);
        }
    }
}
